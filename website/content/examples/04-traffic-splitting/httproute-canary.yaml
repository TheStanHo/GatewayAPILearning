# Canary Deployment Example
# Shows progressive canary rollout pattern
# Adjust weights to gradually increase canary traffic
#
# Related Documentation: Documentation/05-traffic-splitting.md

apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: canary-route
spec:
  parentRefs:
    - name: my-gateway
  hostnames:
    - app.example.com
  rules:
    # Canary deployment with 10% traffic
    # To increase canary:
    #   - Change weights (e.g., 75/25, 50/50, 0/100)
    #   - Apply updated HTTPRoute
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: stable-app
          port: 80
          weight: 90  # 90% of traffic
        - name: canary-app
          port: 80
          weight: 10  # 10% of traffic

# Progressive Rollout Pattern:
# Phase 1: 95/5   (5% canary)
# Phase 2: 90/10  (10% canary) <- Current
# Phase 3: 75/25  (25% canary)
# Phase 4: 50/50  (50% canary)
# Phase 5: 0/100   (100% canary - complete rollout)

