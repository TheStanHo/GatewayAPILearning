# URL Rewriting Example
# Rewrites request paths before forwarding to backend
# Replaces nginx.ingress.kubernetes.io/rewrite-target annotation
#
# Related Documentation: Documentation/07-request-response-modifications.md

apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: rewrite-route
spec:
  parentRefs:
    - name: my-gateway
  hostnames:
    - example.com
  rules:
    # Example 1: Strip /api prefix
    - matches:
        - path:
            type: PathPrefix
            value: /api
      filters:
        # URLRewrite filter replaces the matched prefix
        - type: URLRewrite
          urlRewrite:
            path:
              type: ReplacePrefixMatch
              replacePrefixMatch: /
              # Request: /api/users → Backend receives: /users
      backendRefs:
        - name: api-service
          port: 80
    
    # Example 2: Rewrite to different path
    - matches:
        - path:
            type: PathPrefix
            value: /old-api
      filters:
        - type: URLRewrite
          urlRewrite:
            path:
              type: ReplacePrefixMatch
              replacePrefixMatch: /new-api
              # Request: /old-api/users → Backend receives: /new-api/users
      backendRefs:
        - name: api-service
          port: 80

