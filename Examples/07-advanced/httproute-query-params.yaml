# Query Parameter Matching Example
# Routes based on URL query parameters
# Native in Gateway API, requires server snippets in Nginx Ingress
#
# Related Documentation: Documentation/04-advanced-routing.md

apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
  name: query-params-route
spec:
  parentRefs:
    - name: my-gateway
  hostnames:
    - api.example.com
  rules:
    # Route based on version query parameter
    - matches:
        - queryParams:
            - name: version
              value: v2
              # type: Exact (default)
      backendRefs:
        - name: api-v2-service
          port: 80
    
    # Route based on environment query parameter
    - matches:
        - queryParams:
            - name: env
              value: staging
      backendRefs:
        - name: staging-service
          port: 80
    
    # Regex matching for query parameters
    - matches:
        - queryParams:
            - name: version
              type: RegularExpression
              value: "^v[0-9]+"
              # Matches: ?version=v1, ?version=v2, ?version=v10
      backendRefs:
        - name: api-service
          port: 80
    
    # Default route
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: default-service
          port: 80

